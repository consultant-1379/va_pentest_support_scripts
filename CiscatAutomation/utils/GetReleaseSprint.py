# https://pdu-oss-tools1.seli.wh.rnd.internal.ericsson.com/enm_dbm/api/sprint
import datetime
import re

import requests

def getSprintReleaseList():
    # Specify the URL
    url = 'https://pdu-oss-tools1.seli.wh.rnd.internal.ericsson.com/enm_dbm/api/sprint'
    current_year = datetime.datetime.now().year
    last_two_digits = int(str(current_year)[-2:])

    try:
        # Send the HTTP GET request
        response = requests.get(url, verify=False)
        # Check if the request was successful
        if response.status_code == 200:
            # Parse the JSON response
            json_response = response.json()
            # Print the JSON response
            rel_list = []
            for entry in json_response:
                match = re.match(r'(\d+)\.\d+', entry['releaseLabel'])
                if match and int(match.group(1)) >= last_two_digits:
                    rel_list.append(f"Release: {entry['productLine']} Sprint: {entry['releaseLabel']} ")
            return rel_list
        else:
            raise Exception(f'Error getting sprint and release entries : {response.status_code}')
    except Exception as err:
        raise Exception(f'Error getting sprint and release entries : {err}')

if __name__ == '__main__':
    getSprintReleaseList()